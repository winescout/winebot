require 'rubygems'
require 'spec'

class Autotest::Rspec

  def make_test_cmd(files_to_test)
    return '' if files_to_test.empty?
    return "spec #{files_to_test.keys.flatten.join(' ')} #{add_options_if_present}"
  end
end


Autotest.add_hook :initialize do |at|
  at.add_exception('.git') 
  at.clear_mappings

  at.add_mapping(%r%^(spec/spec_helper)(.*)\.rb$%){
    at.files_matching %r%^spec/(lib)/.*_spec\.rb$%
    
    at.files_matching %r%^spec/.*_spec\.rb$%
  }

  at.add_mapping(%r%^lib/(.*)\.rb$%) { |_, m|
    ["spec/lib/#{m[1]}_spec.rb"]
  }

  at.add_mapping(%r%^(.*)\.rb$%) { |_, m|
    ["spec/#{m[1]}_spec.rb"]
  }
end
